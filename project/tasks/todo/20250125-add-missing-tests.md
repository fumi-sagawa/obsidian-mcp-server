# タスク名: テスト未整備ファイルへのテスト追加

## 概要
全てのソースファイルに対して単体テスト・統合テストの整備状況を確認し、不足しているテストを追加する

## 背景・目的
コードベース全体の品質を保つため、テストカバレッジを向上させる必要がある。現在：
- 一部のファイルに単体テストが存在しない
- 統合テストが未整備のツールがある可能性
- テストが失敗している場合の改善が必要

## To-Be（完了条件）
- [ ] 全ソースファイルのテスト整備状況を調査
  - [ ] 単体テスト（*.test.ts）の有無を確認
  - [ ] 統合テスト（test/tools/*/）の有無を確認
- [ ] テスト未整備ファイルをリストアップ
- [ ] 各未整備ファイルにテストを追加
  - [ ] フォーマット処理系（format-*.ts）
  - [ ] ハンドラー系（*-handler.ts）
  - [ ] 共有ユーティリティ（shared/lib/*)
  - [ ] API関連（shared/api/*)
- [ ] 既存テストの実行と失敗の確認
  - [ ] 失敗しているテストの特定
  - [ ] 失敗原因の分析と修正
- [ ] テストカバレッジが90%以上
- [ ] 全テストが通る（単体・統合両方）

## 実装方針
### フェーズ1: 調査
1. `find`コマンドで全*.tsファイルをリスト化
2. 対応する*.test.tsファイルの存在確認
3. test/tools/配下の統合テストの確認
4. テスト未整備ファイルのリスト作成

### フェーズ2: テスト作成優先順位
1. ビジネスロジックを含むファイル（高優先度）
   - ハンドラー関数
   - フォーマット関数
   - API呼び出し関数
2. ユーティリティ関数（中優先度）
   - エラーハンドリング
   - ログ処理
   - メトリクス収集
3. 設定・型定義（低優先度）

### フェーズ3: テスト実装
1. 型定義駆動でテストを作成
2. 正常系・異常系・エッジケースを網羅
3. モックを適切に使用して独立性を確保
4. 統合テストはMCPプロトコル経由で実装

### フェーズ4: 既存テストの修正
1. 失敗しているテストの原因調査
2. APIの仕様変更への対応
3. モックデータの更新
4. テスト環境の整備

## テストファイル命名規則
- 単体テスト: `[対象ファイル名].test.ts`
- 統合テスト: `test/tools/[機能名]/integration.js` および `mock.js`

## 関連情報
- 現在のテストカバレッジ: `npm test`
- 単体テスト実行: `npm run test:unit`
- 統合テスト実行: `npm run test:tools`
- モックテスト実行: `npm run test:tools:mock`

## 作業ログ
### 作業開始時
- 未実装